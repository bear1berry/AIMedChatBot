import os
from pathlib import Path

from dotenv import load_dotenv

# –ë–∞–∑–æ–≤—ã–µ –ø—É—Ç–∏ –∏ .env
BASE_DIR = Path(__file__).resolve().parent.parent
ENV_PATH = BASE_DIR / ".env"

if ENV_PATH.exists():
    load_dotenv(ENV_PATH)
else:
    load_dotenv()

# –¢–æ–∫–µ–Ω—ã –∏ –∫–ª—é—á–∏
BOT_TOKEN = os.getenv("BOT_TOKEN")
DEEPSEEK_API_KEY = os.getenv("DEEPSEEK_API_KEY")
DEEPSEEK_MODEL = os.getenv("DEEPSEEK_MODEL", "deepseek-chat")
DEEPSEEK_BASE_URL = os.getenv("DEEPSEEK_BASE_URL", "https://api.deepseek.com")

if not BOT_TOKEN:
    raise RuntimeError("BOT_TOKEN is not set in environment variables")

if not DEEPSEEK_API_KEY:
    raise RuntimeError("DEEPSEEK_API_KEY is not set in environment variables")

# –ê–¥–º–∏–Ω—Å–∫–∏–µ ID (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –≤ .env: ADMIN_USER_IDS=12345,67890)
_admin_raw = os.getenv("ADMIN_USER_IDS", "").replace(" ", "")
ADMIN_USER_IDS = {int(x) for x in _admin_raw.split(",") if x.isdigit()}

# –ú–æ–¥—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
DEFAULT_MODE_KEY = "universal"

ASSISTANT_MODES = {
    "universal": {
        "title": "üß† –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π",
        "description": "–û—Ç–≤–µ—Ç—ã –Ω–∞ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã: –æ—Ç –∂–∏–∑–Ω–∏ –¥–æ –∫–æ–¥–∞.",
        "system_prompt": (
            "–¢—ã ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç BlackBoxGPT. "
            "–û—Ç–≤–µ—á–∞–π –ø–æ–Ω—è—Ç–Ω–æ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ –∏ –ø–æ –¥–µ–ª—É. "
            "–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ –º–µ–¥–∏—Ü–∏–Ω—É, –Ω–∞–ø–æ–º–∏–Ω–∞–π, —á—Ç–æ —ç—Ç–æ –Ω–µ –∑–∞–º–µ–Ω–∞ –æ—á–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏."
        ),
    },
    "med": {
        "title": "‚öïÔ∏è –ú–µ–¥–∏—Ü–∏–Ω–∞",
        "description": "–†–∞–∑–±–æ—Ä —Å–∏–º–ø—Ç–æ–º–æ–≤, –∞–Ω–∞–ª–∏–∑–æ–≤, —Å—Ç–∞—Ç–µ–π –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π.",
        "system_prompt": (
            "–¢—ã ‚Äî –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –û–±—ä—è—Å–Ω—è–π –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è, —Å–∏–º–ø—Ç–æ–º—ã, –∞–Ω–∞–ª–∏–∑—ã. "
            "–ù–µ —Å—Ç–∞–≤—å –¥–∏–∞–≥–Ω–æ–∑—ã –∏ –Ω–µ –¥–∞–≤–∞–π –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã—Ö —Å—Ö–µ–º –ª–µ—á–µ–Ω–∏—è. "
            "–í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π, —á—Ç–æ —ç—Ç–æ –Ω–µ –∑–∞–º–µ–Ω–∞ –æ—á–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –≤—Ä–∞—á–∞."
        ),
    },
    "coach": {
        "title": "üî• –ù–∞—Å—Ç–∞–≤–Ω–∏–∫",
        "description": "–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞, –º–æ—Ç–∏–≤–∞—Ü–∏—è –∏ —Ä–∞–∑–±–æ—Ä —Ü–µ–ª–µ–π.",
        "system_prompt": (
            "–¢—ã ‚Äî –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –∏ –∫–æ—É—á. –ü–æ–º–æ–≥–∞–µ—à—å –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ä–µ–∂–∏–º, —Ü–µ–ª–∏, –ø—Ä–∏–≤—ã—á–∫–∏. "
            "–ì–æ–≤–æ—Ä–∏ —á–µ—Å—Ç–Ω–æ, –Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–µ. –ü—Ä–µ–¥–ª–∞–≥–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏."
        ),
    },
    "biz": {
        "title": "üíº –ë–∏–∑–Ω–µ—Å / –ò–¥–µ–∏",
        "description": "–°—Ç–∞—Ä—Ç–∞–ø—ã, –ø—Ä–æ–¥—É–∫—Ç—ã, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ –∞–Ω–∞–ª–∏–∑ –Ω–∏—à.",
        "system_prompt": (
            "–¢—ã ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥ –ø–æ –±–∏–∑–Ω–µ—Å—É –∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º. –ü–æ–º–æ–≥–∞–µ—à—å —Å –∏–¥–µ—è–º–∏, –º–æ–¥–µ–ª—è–º–∏ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏, "
            "—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –ø—Ä–æ–µ–∫—Ç–æ–≤. –î–∞–≤–∞–π —á—ë—Ç–∫–∏–µ, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —à–∞–≥–∏."
        ),
    },
    "creative": {
        "title": "üé® –ö—Ä–µ–∞—Ç–∏–≤",
        "description": "–¢–µ–∫—Å—Ç—ã, –∏–¥–µ–∏, –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, –Ω–∞–∑–≤–∞–Ω–∏—è, –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ç—ã.",
        "system_prompt": (
            "–¢—ã ‚Äî –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –ø–∞—Ä—Ç–Ω—ë—Ä. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å –Ω–∞–∑–≤–∞–Ω–∏—è, –∏–¥–µ–∏, –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, —Ç–µ–∫—Å—Ç—ã. "
            "–ú–æ–∂–µ—à—å –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –Ω–µ–æ–±—ã—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, –Ω–æ –≤—Å–µ–≥–¥–∞ —É—á–∏—Ç—ã–≤–∞–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."
        ),
    },
}

# –¢–∞—Ä–∏—Ñ—ã –∏ –ª–∏–º–∏—Ç—ã
PLAN_LIMITS = {
    "free": {
        "title": "Free",
        "daily_base": 50,
        "description": "–ë–∞–∑–æ–≤—ã–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø.",
    },
    "pro": {
        "title": "Pro",
        "daily_base": 200,
        "description": "–î–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏ —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤.",
    },
    "vip": {
        "title": "VIP",
        "daily_base": 1000,
        "description": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π –∏ –∫–æ–º–∞–Ω–¥.",
    },
}

# –ë–æ–Ω—É—Å –∑–∞ –æ–¥–Ω–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—É—Ç–æ—á–Ω—ã–π –ª–∏–º–∏—Ç)
REF_BONUS_PER_USER = 5

# –¶–µ–Ω—ã —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è Payments API (–≤ –º–∏–Ω–æ—Ä–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö: 100 = 1 RUB)
PAYMENT_PROVIDER_TOKEN = os.getenv("PAYMENT_PROVIDER_TOKEN", "")
PAYMENT_CURRENCY = os.getenv("PAYMENT_CURRENCY", "RUB")

PLAN_PRICES = {
    # –ü—Ä–∏–º–µ—Ä: 199 —Ä—É–±–ª–µ–π => 19900
    "pro": int(os.getenv("PLAN_PRICE_PRO", "19900") or "19900"),
    "vip": int(os.getenv("PLAN_PRICE_VIP", "49900") or "49900"),
}

PAYMENTS_ENABLED = bool(PAYMENT_PROVIDER_TOKEN)

# –°–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –∏—Å—Ç–æ—Ä–∏–∏ —Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
MAX_HISTORY_MESSAGES = 20
